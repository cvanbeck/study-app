<div id="settings-container">
    <div id="settings-toggle">Settings</div>
    <div id="settings-dropdown" style="display: none;">
        <!-- Chat Mode Segment (reserved) -->
        <div class="segment-group">
            <span class="segment-group-heading">Chat Mode:</span>
            <label>
                <input type="radio" name="mode" value="default" checked> Normal
            </label>
            <label>
                <input type="radio" name="mode" value="steps"> Explain in Steps
            </label>
            <label>
                <input type="radio" name="mode" value="example"> Real World Example
            </label>
            <label>
                <input type="radio" name="mode" value="flashcards"> Generate Flashcards
            </label>
            <label>
                <input type="radio" name="mode" value="quizmaster"> Quizmaster
            </label>
        </div>
        <!-- New Thoughts Default Segment -->
        <div class="segment-group">
            <span class="segment-group-heading">Thoughts Tag Default:</span>
            <label>
                <input type="radio" name="thoughtsDefault" value="open" checked> Open
            </label>
            <label>
                <input type="radio" name="thoughtsDefault" value="closed"> Closed
            </label>
        </div>
        <!-- Output Destination -->
        <div class="segment-group">
            <span class="segment-group-heading">Send AI output to:</span>
            <label>
                <input type="radio" name="destination" value="chat" checked> Chat Window
            </label>
            <label>
                <input type="radio" name="destination" value="note"> Notes Editor
            </label>
        </div>
    </div>
</div>

<script>
    window.chatMode = 'default';
    // Toggle dropdown settings menu
    $('#settings-toggle').on('click', function (e) {
        e.stopPropagation();
        const $dropdown = $('#settings-dropdown');

        if ($dropdown.is(':visible')) {
            $dropdown.slideUp();
        } else {
            $dropdown.slideDown({
                start: function () {
                    $(this).css('display', 'flex');
                }
            });
        }
    });

    $(document).on('click', function (event) {
        if (!$(event.target).closest('#settings-container').length) {
            $('#settings-dropdown').slideUp();
        }
    });

    //Handle mode selection
    $('#settings-dropdown input[type="radio"][name="mode"]').on('change', function () {
        const selectedMode = $(this).val();
        $('#response-mode').val(selectedMode);
        window.chatMode = selectedMode;

        if (selectedMode !== "quizmaster") {
            fetch("/reset-quiz-state", { method: "POST" });
        }

        $("#prompt").attr("placeholder", `Message the AI (${$('input[name="mode"]:checked').closest("label").text().trim()})`);
        if (selectedMode === "quizmaster") {
            $("#quizmaster-help").show();
        } else {
            $("#quizmaster-help").hide();
        }
    });

    $('#settings-dropdown input[type="radio"][name="destination"]').on('change', function() {
        const selectedDestination = $(this).val();
        $('#output-destination').val(selectedDestination);
    });
</script>
